<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> WebSSH </title>
    <link href="static/img/favicon.png" rel="icon" type="image/png">
    <link href="static/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="static/css/xterm.min.css" rel="stylesheet" type="text/css"/>
    <link href="static/css/fullscreen.min.css" rel="stylesheet" type="text/css"/>

    <style>
        .row {
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .container {
            margin-top: 20px;
        }

        .btn {
            margin-top: 15px;
        }

        .btnup {
            margin-top: 15px;
            color: yellow; /* æ–‡å­—é¢œè‰² */
            border: 2px solid green; /* è¾¹æ¡†é¢œè‰²å’Œåšåº¦ */
            background-color: transparent; /* é€æ˜èƒŒæ™¯ */
            padding: 10px 20px; /* å†…è¾¹è· */
            font-size: 16px; /* å­—ä½“å¤§å° */
            cursor: pointer; /* é¼ æ ‡æ‚¬åœæ—¶çš„å…‰æ ‡æ ·å¼ */
            border-radius: 5px; /* è¾¹æ¡†åœ†è§’ */
        }

        .btn-danger {
            margin-left: 5px;
        }

        {% if font.family %}
        @font-face {
            font-family: '{{ font.family }}';
            src: url('{{ font.url }}');
        }

        body {
            font-family: '{{ font.family }}';
        }

        {% end %}

        .account-item {
            display: block;
            margin-bottom: 10px;
        }

        .account-item .btn {
            margin-top: 0;
            word-break: break-all;
            white-space: normal;
            text-align: left;
        }

        /* æ–‡ä»¶ç®¡ç†å™¨æ ·å¼ */
        .file-manager-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .file-manager-content {
            background-color: #2c3e50;
            margin: 2% auto;
            padding: 20px;
            border: 1px solid #34495e;
            border-radius: 10px;
            width: 90%;
            max-width: 1200px;
            color: #ecf0f1;
            max-height: 85vh;
            overflow-y: auto;
        }

        .file-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #34495e;
        }

        .file-manager-header h2 {
            margin: 0;
            color: #3498db;
        }

        .close-modal {
            color: #e74c3c;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }

        .close-modal:hover {
            color: #c0392b;
        }

        .file-manager-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .file-manager-actions button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .file-manager-actions button:hover {
            background-color: #2980b9;
        }

        .file-manager-actions button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }

        .current-path {
            background-color: #34495e;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-family: monospace;
            color: #2ecc71;
        }

        .file-list {
            background-color: #34495e;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #2c3e50;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .file-item:hover {
            background-color: #3d566e;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .file-icon {
            font-size: 20px;
        }

        .file-name {
            font-weight: 500;
        }

        .file-size {
            color: #95a5a6;
            font-size: 12px;
            margin-left: auto;
            margin-right: 15px;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .file-actions button {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }

        .file-actions button:hover {
            background-color: #229954;
        }

        .upload-area {
            border: 2px dashed #3498db;
            border-radius: 5px;
            padding: 30px;
            text-align: center;
            margin-top: 20px;
            background-color: #34495e;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: #2ecc71;
            background-color: #3d566e;
        }

        .upload-area.drag-over {
            border-color: #2ecc71;
            background-color: #3d566e;
        }

        #fileInput, #folderInput {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #3498db;
        }

    </style>
</head>
<body>

<div id="waiter" class="layui-row" style="display: none;">

    <button id="file-manager-btn" class="btnup"
         style='z-index:256;position:fixed;width:10%;right:20px;'>æ–‡ä»¶ç®¡ç†å™¨
    </button>

</div>

<!-- æ–‡ä»¶ç®¡ç†å™¨å¼¹çª— -->
<div id="fileManagerModal" class="file-manager-modal">
    <div class="file-manager-content">
        <div class="file-manager-header">
            <h2>ğŸ“ æ–‡ä»¶ç®¡ç†å™¨</h2>
            <span class="close-modal">&times;</span>
        </div>
        
        <div class="file-manager-actions">
            <button id="refreshBtn">ğŸ”„ åˆ·æ–°</button>
            <button id="uploadFileBtn">ğŸ“„ ä¸Šä¼ æ–‡ä»¶</button>
            <button id="uploadFolderBtn">ğŸ“ ä¸Šä¼ æ–‡ä»¶å¤¹</button>
            <button id="parentDirBtn">â¬†ï¸ ä¸Šçº§ç›®å½•</button>
        </div>

        <div class="current-path">
            å½“å‰è·¯å¾„: <span id="currentPath">~</span>
        </div>

        <div id="fileListContainer" class="file-list">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>

        <div class="upload-area" id="uploadArea">
            <p>ğŸ“¤ æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ ï¼Œæˆ–ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶</p>
            <p style="color: #95a5a6; font-size: 12px;">æ”¯æŒå¤šæ–‡ä»¶åŒæ—¶ä¸Šä¼ </p>
        </div>

        <input type="file" id="fileInput" multiple>
        <input type="file" id="folderInput" webkitdirectory directory multiple>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <h5>å·²ä¿å­˜çš„è´¦æˆ·å’Œå¯†ç ï¼šç‚¹å‡»è‡ªåŠ¨å¡«å……</h5>
            <div id="accountList" class="account-item">
            </div>
        </div>
        <div class="col-md-9 form-container" style="display: none">
            <form id="connect" action="" method="post" enctype="multipart/form-data"{% if debug %} novalidate{% end %}>
                <div class="row">
                    <div class="col">
                        <label for="hostname">IP</label>
                        <input class="form-control" type="text" id="hostname" name="hostname" value="" required>
                    </div>
                    <div class="col">
                        <label for="port">ç«¯å£</label>
                        <input class="form-control" type="number" id="port" name="port" placeholder="22" value="22" min=1
                               max=65535>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label for="username">è´¦æˆ·</label>
                        <input class="form-control" type="text" id="username" name="username" value="" required>
                    </div>
                    <div class="col">
                        <label for="password">å¯†ç </label>
                        <input class="form-control" type="password" id="password" name="password" value="">
                    </div>

                </div>
                <div class="row">
                    <div class="col">
                        <label for="privatekey">å¯†é’¥</label>
                        <input class="form-control" type="file" id="privatekey" name="privatekey" value="">
                    </div>
                    <div class="col">
                        <label for="af2">2FAç </label>
                        <input class="form-control" type="number" id="af2" name="af2" placeholder="2FA" value="" min=000001
                               max=999999>
                    </div>
                </div>

                <input type="hidden" id="term" name="term" value="xterm-256color">
                {% module xsrf_form_html() %}
                <button type="reset" class="btn btn-danger">æ¸…é™¤</button>
                <button type="submit" class="btn btn-primary" id="loginButton">ç™»å½•</button>
            </form>
        </div>
    </div>
</div>


<div class="container">
    <div class="content">
        <div class="section">
            <h4>
                <a style="color: #1e9fff"
                   href="https://help.aliyun.com/zh/idaas/security-authentication/product-overview/totp">ä»€ä¹ˆæ˜¯
                    2FAï¼Ÿï¼ˆç±»ä¼¼ä¸€æ¬¡ä¸€å¯†ï¼‰</a>
            </h4>
            <p>
                2FA ä»£è¡¨â€œç¬¬äºŒè®¤è¯å› ç´ â€ã€‚å®ƒæ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¸ºåœ¨çº¿è´¦æˆ·å’Œæ•æ„Ÿæ•°æ®æä¾›é¢å¤–çš„ä¿æŠ¤å±‚ã€‚é€šè¿‡è¦æ±‚é™¤å¯†ç ä¹‹å¤–çš„ç¬¬äºŒç§éªŒè¯å½¢å¼ï¼Œ2AF æœ‰åŠ©äºç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½è®¿é—®ä»–ä»¬çš„è´¦æˆ·ã€‚
            </p>
        </div>
        <div class="section">
            <h4>2FA å¦‚ä½•å·¥ä½œï¼Ÿ</h4>
            <p>
                2FA çš„è¿‡ç¨‹é€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼š
            </p>
            <ul>
                <li>é¦–å…ˆï¼Œç”¨æˆ·åƒå¾€å¸¸ä¸€æ ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</li>
                <li>ç„¶åï¼Œç”¨æˆ·éœ€è¦æä¾›ç¬¬äºŒç§å½¢å¼çš„è®¤è¯ï¼Œä¾‹å¦‚å‘é€åˆ°å…¶ç§»åŠ¨è®¾å¤‡çš„ä»£ç ã€æŒ‡çº¹æ‰«ææˆ–ç¡¬ä»¶ä»¤ç‰Œã€‚</li>
            </ul>
            <p>
                é€šè¿‡è¿™ç¬¬äºŒæ­¥ï¼Œå¢åŠ äº†ä¸€å±‚é¢å¤–çš„å®‰å…¨æ€§ï¼Œä½¿æ”»å‡»è€…æ›´éš¾è·å¾—æœªç»æˆæƒçš„è®¿é—®æƒé™ã€‚
            </p>
        </div>
    </div>
</div>
<div class="container">
    <div id="status" style="color: red;"></div>
    <div id="terminal"></div>
</div>

<script src="static/js/jquery.min.js"></script>
<script src="static/js/popper.min.js"></script>
<script src="static/js/bootstrap.min.js"></script>
<script src="static/js/xterm.min.js"></script>
<script src="static/js/xterm-addon-fit.min.js"></script>
<script src="static/js/main.js"></script>
<script>
    window.addEventListener('beforeunload', function (e) {
        var confirmationMessage = 'æ‚¨ç¡®å®šè¦ç¦»å¼€æ­¤é¡µé¢å—ï¼Ÿ';
        e.returnValue = confirmationMessage;  // ç°ä»£æµè§ˆå™¨ä¼šå¿½ç•¥è¿™ä¸ªå±æ€§ï¼Œä½†ä»éœ€è¦å­˜åœ¨
        return confirmationMessage;           // ä¸€äº›è€æµè§ˆå™¨ä½¿ç”¨è¿™ä¸ªè¿”å›å€¼
    });
</script>


<script>
    // é¡µé¢åŠ è½½æ—¶æ›´æ–°å·²ä¿å­˜çš„è´¦æˆ·å’Œå¯†ç åˆ—è¡¨
    window.onload = function () {
        updateAccountList();
    };

    // ç›‘å¬ç™»å½•æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶
    document.getElementById('loginButton').addEventListener('click', function () {
        var hostname = document.getElementById('hostname').value;
        var port = document.getElementById('port').value;
        var username = document.getElementById('username').value;
        var password = document.getElementById('password').value;

        // è·å–æœ¬åœ°å­˜å‚¨ä¸­å·²ä¿å­˜çš„è´¦æˆ·å’Œå¯†ç æ•°ç»„ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆå§‹åŒ–ä¸ºç©ºæ•°ç»„
        var accounts = JSON.parse(localStorage.getItem('accounts')) || [];

        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒçš„è´¦æˆ·ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¸æ·»åŠ 
        var existingAccount = accounts.find(function (account) {
            return account.hostname === hostname && account.port === port && account.username === username && account.password === password;
        });

        if (!existingAccount) {
            // å°†æ–°çš„è´¦æˆ·å’Œå¯†ç æ·»åŠ åˆ°æ•°ç»„ä¸­
            accounts.push({hostname: hostname, port: port, username: username, password: password});

            // å°†æ›´æ–°åçš„æ•°ç»„ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä¸­
            localStorage.setItem('accounts', JSON.stringify(accounts));

            // æ›´æ–°å·²ä¿å­˜çš„è´¦æˆ·å’Œå¯†ç åˆ—è¡¨
            updateAccountList();
        } else {
            console.log('è¯¥è´¦æˆ·å·²å­˜åœ¨ï¼Œæ— éœ€é‡å¤ä¿å­˜ã€‚');
        }
    });

    // æ›´æ–°å·²ä¿å­˜çš„è´¦æˆ·å’Œå¯†ç åˆ—è¡¨
    function updateAccountList() {
        var accountList = document.getElementById('accountList');
        accountList.innerHTML = '';

        // è·å–æœ¬åœ°å­˜å‚¨ä¸­å·²ä¿å­˜çš„è´¦æˆ·å’Œå¯†ç æ•°ç»„
        var accounts = JSON.parse(localStorage.getItem('accounts')) || [];

        // éå†æ•°ç»„ï¼Œåˆ›å»ºæŒ‰é’®ã€åˆ é™¤æŒ‰é’®å’Œè´¦æˆ·ä¿¡æ¯ï¼Œå¹¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­
        accounts.forEach(function (account) {
            var accountItem = document.createElement('div');
            accountItem.className = 'account-item';

            var button = document.createElement('button');
            button.className = 'btn btn-secondary';
            button.textContent = account.hostname + ' â— ' + account.port + ' â— ' + account.username;
            button.addEventListener('click', function () {
                document.getElementById('hostname').value = account.hostname;
                document.getElementById('port').value = account.port;
                document.getElementById('username').value = account.username;
                document.getElementById('password').value = account.password;
            });
            accountItem.appendChild(button);

            var closeButton = document.createElement('button');
            closeButton.className = 'btn btn-danger btn-sm ml-2';
            closeButton.textContent = 'Ã—';
            closeButton.addEventListener('click', function () {
                removeAccount(account);
            });
            accountList.appendChild(accountItem);
            accountItem.appendChild(closeButton);
        });
    }

    // åˆ é™¤è´¦æˆ·å’Œå¯†ç 
    function removeAccount(account) {
        var accounts = JSON.parse(localStorage.getItem('accounts')) || [];
        var filteredAccounts = accounts.filter(function (item) {
            return item.hostname !== account.hostname || item.port !== account.port || item.username !== account.username || item.password !== account.password;
        });
        localStorage.setItem('accounts', JSON.stringify(filteredAccounts));
        updateAccountList();
    }
</script>
</body>
</html>

